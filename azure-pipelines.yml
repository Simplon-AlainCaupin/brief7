# Starter pipeline

# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- main

strategy:
  matrix:
    linux:
      imageName: "ubuntu-latest"
#    mac:
#      imageName: "macOS-latest"
#    windows:
#      imageName: "windows-latest"
  maxParallel: 3

pool:
  vmImage: $(imageName)

steps:
  - task: Kubernetes@1
    inputs:
      connectionType: 'Kubernetes Service Connection'
      KubernetesServiceEndpoint: 'serviceconnectionakslain'
      namespace: 'default'
      command: 'top'
      arguments: 'pod'

  - task: Bash@3
    inputs:
      targetType: 'inline'
      script: |   
        curl 'https://hub.docker.com/v2/repositories/simplonasa/azure_voting_app/tags' | jq '."results"[0]["name"]'